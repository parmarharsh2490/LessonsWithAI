<p-dialog
  [(visible)]="visible"
  (onHide)="handleHide()"
  [modal]="true"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
  [style]="{ width: '70vw' }"
  [draggable]="false"
  [resizable]="false"
>
  <div class="p-2 sm:p-4">
    <div
      class="flex flex-col sm:flex-row justify-start items-start sm:items-center gap-1 sm:gap-2 mb-3 sm:mb-4"
    >
      <span class="text-sm sm:text-base">{{
        callReport()?.startedAt | date: "dd/MM/yyyy HH:mm"
      }}</span>
      <span class="text-sm sm:text-base">{{ callReport()?.type }}</span>
    </div>
    <div class="space-y-3 sm:space-y-4">
      <div
        class="flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3 sm:gap-4"
      >
        <div class="flex flex-col gap-1 flex-1">
          <div class="text-xs sm:text-sm font-medium text-secondary">
            Assistant ID
          </div>
          <span class="text-sm sm:text-base">
            {{ callReport()?.assistantId }}
          </span>
        </div>
        <div class="flex flex-col gap-1 flex-1">
          <div class="text-xs sm:text-sm font-medium text-secondary">
            Call ID
          </div>
          <span class="text-sm sm:text-base"> {{ callReport()?.id }} </span>
        </div>
      </div>
      <div
        class="flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3 sm:gap-4"
      >
        <div class="flex flex-col gap-1 flex-1">
          <div class="text-xs sm:text-sm font-medium text-secondary">
            Duration
          </div>
          <span class="text-sm sm:text-base"> {{ getCallDuration() }} </span>
        </div>
        <div class="flex flex-col gap-1 flex-1">
          <div class="text-xs sm:text-sm font-medium text-secondary">Cost</div>
          <span class="text-sm sm:text-base"> {{ callReport()?.cost }} </span>
        </div>
      </div>
      <div>
        <p-tabs value="0">
          <p-tablist>
            <p-tab value="0">Conversation</p-tab>
            <p-tab value="1">Summary</p-tab>
            <!-- <p-tab value="2">Success Evaluation</p-tab> -->
            <p-tab value="3">Recording</p-tab>
          </p-tablist>
          <p-tabpanels>
            <!-- Conversation Tab -->
            <p-tabpanel value="0">
              <div>
                <div
                  class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 sm:gap-0 mb-3 sm:mb-4"
                >
                  <h6 class="text-base sm:text-lg">Conversation</h6>
                  <p-button
                    label="Download Transcript"
                    icon="pi pi-download"
                    [size]="'small'"
                    (onClick)="downloadTranscript()"
                  />
                </div>
                <div
                  class="space-y-2 sm:space-y-3 max-h-[60vh] overflow-y-auto"
                >
                  @for (message of callReport()?.messages; track message.time) {
                    <div class="mb-2 sm:mb-3 p-2 sm:p-3 border rounded">
                      <div
                        class="flex flex-col sm:flex-row items-start gap-2 sm:gap-3"
                      >
                        <span
                          class="text-tertiary text-xs sm:text-sm whitespace-nowrap"
                          >{{
                            message.time | date: "MMM dd, yyyy hh:mm:ss a"
                          }}</span
                        >
                        <div class="flex-1 min-w-0">
                          <strong class="capitalize text-sm sm:text-base"
                            >{{ message.role }}:</strong
                          >
                          <p class="mb-0 mt-1 text-sm sm:text-base break-words">
                            {{ message.message }}
                          </p>
                        </div>
                      </div>
                    </div>
                  }
                </div>
              </div>
            </p-tabpanel>
            <!-- Summary Tab -->
            <p-tabpanel value="1">
              <div>{{ callReport()?.summary || "No summary available" }}</div>
              <!-- <div class="row">
                    <div class="col-md-6">
                      <div class="d-flex flex-column gap-1">
                        <div class="">Call Outcome</div>
                        <span>
                          {{
                            callReport()?.analysis?.structuredData?.callOutcome
                          }}
                        </span>
                      </div>
                      <div class="d-flex flex-column gap-1">
                        <div>Call Sentiment</div>
                        <span>
                          {{
                            callReport()?.analysis?.structuredData
                              ?.callSentiment
                          }}
                        </span>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="d-flex flex-column gap-1">
                        <div class="">Follow-up Status</div>
                        <span>
                          {{
                            callReport()?.analysis?.structuredData
                              ?.followUpStatus
                          }}
                        </span>
                      </div>
                      <div class="d-flex flex-column gap-1">
                        <div class="">Objective Achievement</div>
                        <span>
                          {{
                            callReport()?.analysis?.structuredData
                              ?.objectiveAchievement
                          }}
                        </span>
                      </div>
                    </div>
                  </div> -->
            </p-tabpanel>
            <!-- Success Evaluation Tab -->
            <!-- <p-tabpanel value="2">
              <div class="">
                <h6 class="mb-3">Success Evaluation</h6>
                <div class="">
                  <div class="p-3 border rounded">
                    {{
                      callReport()?.analysis?.successEvaluation ||
                        "No evaluation available"
                    }}
                  </div>
                </div>
              </div>
            </p-tabpanel> -->
            <!-- Recording Tab -->
            <p-tabpanel value="3">
              @if (callReport()?.recordingUrl) {
                <div class="audio-player mb-3">
                  <audio controls class="w-full">
                    <source
                      [src]="callReport()?.recordingUrl"
                      type="audio/wav"
                    />
                    Your browser does not support the audio element.
                  </audio>
                </div>
              } @else {
                <p class="text-tertiary">
                  No recording available for this call.
                </p>
              }
            </p-tabpanel>
          </p-tabpanels>
        </p-tabs>
      </div>
    </div>
  </div>
</p-dialog>
